# An√°lise Estrat√©gica e T√©cnica da Plataforma GEREZIM Private Club

## SE√á√ÉO 1: POSICIONAMENTO ESTRAT√âGICO

### 1.1. Manifesto do Produto GEREZIM

#### O que √© GEREZIM?
GEREZIM √© um **clube privado digital exclusivo** para intermedia√ß√£o de oportunidades de neg√≥cios de alto valor, onde membros selecionados acessam um ecossistema curado de deals, investimentos e negocia√ß√µes que n√£o est√£o dispon√≠veis ao mercado comum.

#### O que N√ÉO √© GEREZIM?
- Marketplace aberto (n√£o √© OLX, Imobili√°rio.com ou Amazon)
- Plataforma de crowdfunding
- Rede social de neg√≥cios (n√£o √© LinkedIn)
- Plataforma de e-commerce
- Sistema gen√©rico de CRM
- Servi√ßo de consultoria

#### Qual problema resolve?
**Para investidores, empres√°rios e tomadores de decis√£o:**
- Dificuldade de acessar oportunidades exclusivas e vetadas (off-market)
- Falta de intermedi√°rios confi√°veis e curados
- Impossibilidade de terceirizar an√°lise de viabilidade de deals
- Desperd√≠cio de tempo em filtragem manual de oportunidades
- Incerteza sobre reputa√ß√£o e confiabilidade de contatos

**Para intermediadores e consultores:**
- Necessidade de plataforma profissional para gerenciar clientes
- Dificuldade em rastrear deals e fechar negocia√ß√µes
- Falta de sistema para controlar acesso exclusivo a oportunidades
- Perda de oportunidades por desorganiza√ß√£o

#### Para quem √©?
**Membros Premium:**
1. **Investidores Anjos / Family Offices** - buscam deals pr√©-filtrados de alto padr√£o
2. **Empres√°rios** - procuram aquisi√ß√µes, expans√£o e parcerias estrat√©gicas
3. **Construtoras / Incorporadoras** - buscam terrenos e projetos exclusivos
4. **Consultores de Neg√≥cios** - usam como ferramenta de gest√£o
5. **Family Offices** - buscam gest√£o patrimonial e investimentos

**Intermediadores:**
- Corretores high-end
- Consultores de neg√≥cios
- Agentes imobili√°rios premium
- Consultores de investimento
- M&A Advisors

#### Como gera valor?
1. **Para Membros:**
   - Acesso a deals exclusivos 80% mais cedo que o mercado
   - Triagem profissional por intermediadores de confian√ßa
   - Valida√ß√£o de viabilidade via m√≥dulo de an√°lise
   - Contatos pr√©-verificados e confi√°veis
   - Hist√≥rico de comportamento para recomenda√ß√µes personalizadas

2. **Para Intermediadores:**
   - Gest√£o centralizada de clientes e oportunidades
   - Sistema de aprova√ß√£o para controlar acesso
   - Auditoria completa de atividades
   - Integra√ß√£o com concierge para suporte premium
   - Comiss√µes transparentes e rastre√°veis

3. **Para a Plataforma:**
   - Rede de efeito (mais membros = mais oportunidades = mais valor)
   - Dados de comportamento para IA de matching
   - M√∫ltiplas fontes de receita (assinatura, taxa de sucesso, servi√ßos premium)

---

### 1.2. Estrutura de Planos / Camadas de Acesso

GEREZIM opera em tr√™s camadas de membros exclusivos, cada uma com direitos e privil√©gios espec√≠ficos:

#### **N√çVEL SILVER** (Membro Iniciante)
- **Custo:** R$ 4.900/ano ou R$ 490/m√™s
- **Uso:** Explorador de oportunidades, primeiro contato
- **Acessos:**
  - ‚úì Visualiza√ß√£o de 60% das oportunidades p√∫blicas
  - ‚úì At√© 5 pedidos especiais por m√™s
  - ‚úì Acesso ao concierge com limite de 2h/m√™s
  - ‚úì Hist√≥rico b√°sico (√∫ltimos 90 dias)
  - ‚úì 1 relat√≥rio de valuation express/m√™s
  - ‚úó Acesso a deals off-market
  - ‚úó An√°lise priorit√°ria
  - ‚úó Matching autom√°tico

#### **N√çVEL GOLD** (Membro Ativo)
- **Custo:** R$ 14.900/ano ou R$ 1.490/m√™s
- **Uso:** Negociador ativo, portfolio acompanhador
- **Acessos:**
  - ‚úì Visualiza√ß√£o de 100% das oportunidades p√∫blicas
  - ‚úì Acesso a 30% das oportunidades off-market (deals privados)
  - ‚úì At√© 20 pedidos especiais por m√™s
  - ‚úì Acesso priorit√°rio ao concierge (8h/m√™s)
  - ‚úì Hist√≥rico completo (√∫ltimos 12 meses)
  - ‚úì Unlimited relat√≥rios de valuation express
  - ‚úì Matching inteligente 2x/semana
  - ‚úì Notifica√ß√µes de "match perfeito"
  - ‚úó Deals 100% privados (Black Book)
  - ‚úó Acesso a investment club exclusivo
  - ‚úó Concierge dedicado

#### **N√çVEL BLACK** (Membro Institucional)
- **Custo:** R$ 49.900/ano ou R$ 4.990/m√™s (+ taxa de sucesso vari√°vel)
- **Uso:** Grandes alocadores, investidores institucionais, multi-deal
- **Acessos:**
  - ‚úì Visualiza√ß√£o de 100% de TODAS as oportunidades
  - ‚úì Acesso total ao Black Book (deals 100% privados + confidenciais)
  - ‚úì Unlimited pedidos especiais
  - ‚úì Concierge dedicado 24h (gestor de relacionamento)
  - ‚úì Hist√≥rico completo com analytics avan√ßadas
  - ‚úì Valuation completa (n√£o apenas express)
  - ‚úì Matching inteligente cont√≠nuo (daily)
  - ‚úì Deal origination customizado (GEREZIM procura deals para voc√™)
  - ‚úì Investment club exclusivo (networking premium)
  - ‚úì Due diligence facilitada
  - ‚úì Prioridade m√°xima em processamento
  - ‚úì Consultoria estrat√©gica inclusa

#### Benef√≠cios Transversais Todos os N√≠veis:
- Dashboard personalizado por tipo de usu√°rio
- Notifica√ß√µes em tempo real
- Mobile app completo
- Suporte por email 24h
- Acesso ao blog e research
- Comunidade restrita de membros

---

## SE√á√ÉO 2: VIS√ÉO T√âCNICA INTEGRADA

O sistema GEREZIM √© um MVP robusto de uma plataforma de intermedia√ß√£o de neg√≥cios com suporte a m√∫ltiplos n√≠veis de acesso, permitindo o gerenciamento de oportunidades exclusivas, clientes, pipeline de vendas, sistema de convites privados, assistente concierge e solicita√ß√µes de produtos/servi√ßos curados.

---

## SE√á√ÉO 3: MAPA DE FLUXOS DO USU√ÅRIO

### 3.1. Fluxo de Onboarding com Convite

```
Visitante P√∫blico
    ‚Üì
Preenche formul√°rio de solicita√ß√£o (nome, email, WhatsApp, interesse)
    ‚Üì
Insere c√≥digo de convite (valida√ß√£o em tempo real)
    ‚Üì
Solicita acesso ‚Üí Email de confirma√ß√£o enviado
    ‚Üì
[PAUSA] Aguarda aprova√ß√£o de administrador
    ‚Üì
Admin revisa perfil ‚Üí Aprovar/Rejeitar
    ‚Üì
SE APROVADO:
  - Conta criada automaticamente
  - Email com credenciais tempor√°rias
  - Acesso imediato com n√≠vel Silver (padr√£o)
  - Onboarding em 3 etapas (produto, interface, recursos)
    ‚Üì
SE REJEITADO:
  - Email com motivo da rejei√ß√£o
  - Sugest√£o de tentar novamente em X dias
```

**Tabelas Envolvidas:**
- `pending_members` (candidatos em revis√£o)
- `profiles` (perfil criado ap√≥s aprova√ß√£o)
- `invites` (rastreio de c√≥digo usado)
- `audit_logs` (registro de cada etapa)

---

### 3.2. Fluxo de Upgrade de N√≠vel

```
Membro Silver (atual)
    ‚Üì
Acessa "Upgrade" no painel
    ‚Üì
V√™ op√ß√µes: Gold (R$ 1.490/m√™s) ou Black (R$ 4.990/m√™s)
    ‚Üì
Clica em "Solicitar Upgrade"
    ‚Üì
Preenche justificativa (opcional)
    ‚Üì
[CASO SILVER‚ÜíGOLD]
  - Aprova√ß√£o autom√°tica em at√© 2h
  - Email de boas-vindas
  - Acesso ativado imediatamente
    ‚Üì
[CASO SILVER/GOLD‚ÜíBLACK ou GOLD‚ÜíBLACK]
  - Vai para fila de aprova√ß√£o manual
  - Admin verifica hist√≥rico, atividade, reputa√ß√£o
  - Email com decis√£o e data de ativa√ß√£o
```

**Tabelas Envolvidas:**
- `profiles` (update de `membership_tier`)
- `subscription_requests` (novo: rastreio de solicita√ß√µes)
- `audit_logs` (registro de upgrades)

---

### 3.3. Fluxo de Acesso a Oportunidades por N√≠vel

```
MEMBRO SILVER:
  Acessa /oportunidades
  ‚Üì
  V√™ filtro por categoria
  ‚Üì
  Visualiza 60% das oportunidades p√∫blicas
  ‚Üì
  Clica em uma ‚Üí V√™ detalhes completos
  ‚Üì
  Bot√£o "Solicitar Apresenta√ß√£o" ‚Üí vai para Concierge

MEMBRO GOLD:
  Acessa /oportunidades
  ‚Üì
  V√™ filtro por: categoria, faixa de valor, localiza√ß√£o, confidencialidade
  ‚Üì
  Visualiza 100% das oportunidades p√∫blicas + 30% do Black Book
  ‚Üì
  Deals que voc√™ "match" aparecem com "üî• Perfect Match" (via IA)
  ‚Üì
  Notifica√ß√µes di√°rias de novos matches

MEMBRO BLACK:
  Acessa /black-book (se√ß√£o privada 100%)
  ‚Üì
  V√™ TODAS as oportunidades (p√∫blicas + privadas + confidenciais)
  ‚Üì
  Filtros avan√ßados: volume de deal, ROI esperado, tipo de investidor etc
  ‚Üì
  Contato direto com intermediador
  ‚Üì
  Atribui gestor de relacionamento (concierge dedicado)
  ‚Üì
  Recebe deal origination customizado
```

**Tabelas Envolvidas:**
- `products` / `opportunities` (com campo `confidentiality_level`: public, gold, black)
- `user_matches` (novo: rastreio de matches autom√°ticos via IA)
- `view_history` (novo: rastreio do que usu√°rio visualizou)

---

### 3.4. Fluxo de Solicita√ß√£o de Pedido Especial (Concierge)

```
Membro (qualquer n√≠vel)
    ‚Üì
Acessa /solicitar-pedido
    ‚Üì
Preenche:
  - Tipo de oportunidade desejada (ex: "Im√≥vel em SP com 500m¬≤ acima de 5M")
  - Prazo
  - Or√ßamento aproximado
  - Detalhes adicionais
    ‚Üì
Submete ‚Üí Cria√ß√£o de ticket no sistema
    ‚Üì
[FILA DE PROCESSAMENTO]
  Black: Prioridade m√°xima (0-24h de retorno)
  Gold: Prioridade alta (0-48h)
  Silver: Prioridade normal (3-5 dias)
    ‚Üì
Concierge pesquisa na rede + Black Book
    ‚Üì
Envia sugest√µes (at√© 5 por padr√£o)
    ‚Üì
Membro feedback ‚Üí Refina busca
    ‚Üì
Quando encontrar algo: "Deal Match" ‚Üí Apresenta√ß√£o formal
    ‚Üì
Intermediador faz contato direto
```

**Tabelas Envolvidas:**
- `pedido_requests` (com campo `priority_level`)
- `request_comments` (novo: conversa sobre o pedido)
- `request_matches` (novo: deals sugeridos para cada pedido)

---

### 3.5. Fluxo de Conciergeria Dedicada (Black)

```
Membro Black
    ‚Üì
Acessa /concierge
    ‚Üì
V√™ gestor atribu√≠do (nome, telefone, email)
    ‚Üì
Op√ß√µes:
  1. Chat com gestor (mensagens em tempo real)
  2. Agendar call (integra√ß√£o com calend√°rio)
  3. Enviar documentos (upload seguro)
  4. Ver hist√≥rico de atendimentos
    ‚Üì
Gestor recebe notifica√ß√£o ‚Üí Prioridade m√°xima
    ‚Üì
Atendimento: consultoria, an√°lise de viabilidade, negotiation support
    ‚Üì
Caso gere neg√≥cio: Registro de conclus√£o + feedback
```

**Tabelas Envolvidas:**
- `concierge_conversations` (com campo `assigned_concierge`)
- `concierge_chats` (novo: mensagens em tempo real)
- `concierge_calls` (novo: hist√≥rico de chamadas)
- `request_matches` (atualizado: resultado do atendimento)

---

### 3.6. Fluxo de Cria√ß√£o de Oportunidade por Intermediador

```
Intermediador (autenticado)
    ‚Üì
Acessa /dashboard/oportunidades/nova
    ‚Üì
Preenche:
  - T√≠tulo, categoria, valor, localiza√ß√£o
  - Descri√ß√£o detalhada
  - Fotos/documentos
  - N√≠vel de confidencialidade (p√∫blico / gold / black)
  - Interessados espec√≠ficos (opcional)
    ‚Üì
Salva como RASCUNHO
    ‚Üì
Pr√©-visualiza√ß√£o com dados fict√≠cios
    ‚Üì
Publica (de imediato ou agenda para data espec√≠fica)
    ‚Üì
[SE PUBLIC]
  - Vis√≠vel para todos Ouro+
  - Notifica√ß√£o autom√°tica para matches
  - Contador de visualiza√ß√µes
    ‚Üì
[SE GOLD]
  - Vis√≠vel somente para Ouro
  - Notifica√ß√£o exclusiva para Ouro que combinam
    ‚Üì
[SE BLACK]
  - Vis√≠vel somente para Black
  - Notifica√ß√£o exclusiva com "Deal Origination"
  - Contato direto (sem intermedi√°rios adicionais)
```

**Tabelas Envolvidas:**
- `products` / `opportunities` (com status draft/published)
- `product_views` (novo: an√°lise de quantas vezes foi visualizado)
- `product_notifications` (novo: rastreio de quem foi notificado)

---

### 3.7. Fluxo de An√°lise de Viabilidade (Valuation Express)

```
Membro (Gold+ autorizado a solicitar)
    ‚Üì
Acessa /valuation-express
    ‚Üì
Seleciona tipo: Empresa / Im√≥vel / Carro de Luxo
    ‚Üì
Preenche dados b√°sicos (localiza√ß√£o, tamanho, receita, etc)
    ‚Üì
Faz upload de documentos (opcional)
    ‚Üì
Submete solicita√ß√£o
    ‚Üì
[FILA AN√ÅLISE]
  Black: 0-4h
  Gold: 0-24h
    ‚Üì
IA processa (preliminary assessment)
    ‚Üì
Analista revisa + adiciona insights
    ‚Üì
Gera relat√≥rio em PDF (executive summary)
    ‚Üì
Envia email com resultado + contato de especialista
    ‚Üì
Membro pode:
  - Solicitar an√°lise mais profunda (upgrade)
  - Marcar como "interessado" (salva hist√≥rico)
  - Compartilhar com s√≥cios (link seguro)
```

**Tabelas Envolvidas:**
- `valuation_requests` (novo: rastreio de solicita√ß√µes)
- `valuation_reports` (novo: armazenamento de relat√≥rios)
- `valuation_analysis` (novo: dados t√©cnicos da an√°lise)

---

### 3.8. Fluxo de Compartilhamento e Rastreio de Convers√£o

```
Membro
    ‚Üì
V√™ oportunidade interessante ‚Üí Clica "Compartilhar"
    ‚Üì
Op√ß√µes:
  1. WhatsApp (gera link √∫nico rastre√°vel)
  2. Email (mesmo)
  3. Copiar link (mesmo)
  4. Enviar para contato no GEREZIM
    ‚Üì
Link √∫nico criado + QR Code
    ‚Üì
Intermediador v√™ em tempo real:
  - Quem compartilhou
  - Com quem foi compartilhado (se contato GEREZIM)
  - Quantas vezes o link foi aberto
  - Se resultou em contato/interesse
    ‚Üì
Rastreio na timeline:
  - "Jo√£o compartilhou com Maria (aberto 3x)"
  - "Maria clicou para contato" 
  - "Negocia√ß√£o iniciada"
    ‚Üì
Dashboard de convers√£o:
  - Taxa de convers√£o por oportunidade
  - Intermediadores mais eficientes
  - Padr√µes de comportamento
```

**Tabelas Envolvidas:**
- `links` (atualizado: com tracking de cliques e compartilhamentos)
- `link_clicks` (novo: rastreio detalhado)
- `conversion_funnel` (novo: an√°lise de convers√£o)

---

### 3.9. Fluxo de Hist√≥rico e DNA de Compra

```
Membro Black/Gold (ap√≥s 30 dias na plataforma)
    ‚Üì
Acessa /my-profile/buying-dna
    ‚Üì
Visualiza:
  1. Categorias mais visualizadas (% do tempo)
  2. Faixa de valor preferida (gr√°fico)
  3. Localidades de interesse (mapa)
  4. Tipos de deal que geram cliques (listagem)
  5. Taxa de convers√£o pessoal vs m√©dia
  6. Oportunidades salvas / em negocia√ß√£o / fechadas
    ‚Üì
Sistema oferece:
  - "Recomenda√ß√µes baseadas no seu perfil"
  - "Voc√™ tem 3 deals similares a este"
  - "Novo deal em SP te aguarda"
    ‚Üì
IA usa dados para:
  - Melhorar matching autom√°tico
  - Sugerir upgrades de n√≠vel
  - Personalizar notifica√ß√µes
  - Criar relat√≥rios de insight
```

**Tabelas Envolvidas:**
- `view_history` (novo: rastreio de visualiza√ß√µes)
- `click_history` (novo: rastreio de cliques)
- `user_preferences` (novo: prefer√™ncias inferidas)
- `recommendations` (novo: sugest√µes geradas por IA)

---

## SE√á√ÉO 4: ESTRUTURA T√âCNICA
- **Framework**: Next.js 14 (App Router)
- **Linguagem**: TypeScript
- **UI Framework**: Tailwind CSS
- **Componentes UI**: Shadcn/UI, Radix UI
- **√çcones**: Lucide React
- **Gr√°ficos**: Google Charts, Recharts
- **Anima√ß√µes**: Framer Motion
- **Gerenciamento de Depend√™ncias**: npm
 - **Toasts**: Sonner
 - **3D/GLSL**: react-three-fiber, three.js, ShaderMaterials personalizados
 - **Menus e Intera√ß√µes**: componentes customizados em `style/` (ex.: `appmenu.tsx`, `efeito-sidebar.tsx`)
 - **Emails**: Resend para envio de comunica√ß√µes
 - **Drag and Drop**: @dnd-kit para funcionalidades interativas
 - **UI Avan√ßada**: @ark-ui/react para componentes acess√≠veis

### Backend
- **Backend as a Service**: Supabase (Autentica√ß√£o, Banco de Dados, Armazenamento)
- **Banco de Dados**: PostgreSQL
- **Autentica√ß√£o**: Supabase Auth
- **Storage**: Supabase Storage para imagens
 - **RLS (Row Level Security)**: pol√≠ticas finas por tabela com fun√ß√µes auxiliares
 - **RPC Functions**: fun√ß√µes definidas no banco para leitura administrativa segura

### Infraestrutura
- **Frontend**: Next.js App Router com Server Actions para opera√ß√µes que requerem autentica√ß√£o
- **Backend**: Supabase (PostgreSQL + Auth + Storage)
- **Estilo**: Tailwind CSS com componentes acess√≠veis
 - **Deploy**: Vercel, com `NEXT_PUBLIC_SUPABASE_URL` e `NEXT_PUBLIC_SUPABASE_ANON_KEY` configurados

### Ferramentas / Bibliotecas adicionais (adicionadas / utilizadas recentemente)
- **react-three-fiber / three.js** ‚Äî usado para efeitos gr√°ficos 3D e planos com shaders (ex.: `style/shader1.tsx`, `style/shader-bg.tsx`).
- **ShaderMaterials personalizados** ‚Äî componentes que usam GLSL (vertex/fragment shaders) para efeitos visuais avan√ßados.
- **Sonner** ‚Äî biblioteca usada para os toasts informativos (ex.: `src/components/ui/sonner.tsx`).
- **Framer Motion** ‚Äî anima√ß√µes e transi√ß√µes (diversos componentes UI como `style/appmenu.tsx`, `style/efeito-sidebar.tsx` e outros).  
- **@supabase/ssr / createBrowserClient** ‚Äî utiliza√ß√£o do cliente Supabase para browser/SSR (com aten√ß√£o para uso em server-side - ver observa√ß√µes de build).
 - **Lucide React** ‚Äî √≠cones consistentes em toda a UI.
 - **Radix UI** ‚Äî acessibilidade e patterns de UI robustos (dropdowns, dialogs).
 - **Tailwind Plugins** ‚Äî configura√ß√£o central em `tailwind.config.ts` e `postcss.config.js`.

### Ferramentas Adicionadas Recentemente (Sistema de Tarefas e Timeline)
- **Server Actions** ‚Äî implementadas para gerenciamento de tarefas de forma segura no servidor
- **Supabase RLS Policies** ‚Äî pol√≠ticas de seguran√ßa em n√≠vel de linha para controle de acesso baseado em role (admin)
- **Supabase RPC Functions** ‚Äî fun√ß√µes PostgreSQL que ignoram RLS para leitura de logs administrativos
 - **Admin Checks** ‚Äî endpoint `GET /api/auth/check-admin` para verifica√ß√£o de permiss√µes.
 - **Logs com bypass seguro** ‚Äî `get_opportunity_logs()` com SECURITY DEFINER.

## Estrutura do Projeto

O projeto est√° dividido em duas partes principais:

### Frontend (`/frontend`)
- `src/app/` - P√°ginas e layouts do Next.js App Router
- `src/components/` - Componentes reutiliz√°veis
- `src/lib/supabase/` - Configura√ß√£o e clientes do Supabase
- `src/components/ui/` - Componentes de UI do shadcn
 - `src/actions/` - Server Actions para tarefas, convites, membros, links e logs
 - `src/app/api/` - Rotas API (ex.: `auth/check-admin`)
 - `style/` - Componentes visuais e efeitos (3D, shaders, carrossel)

### Backend (`/backend`)
- `schema.sql` - Script de cria√ß√£o do banco de dados com RLS (Row Level Security)
- `seed.sql` - Dados de exemplo para testes
- `migrations/` - Pasta para futuras migra√ß√µes de banco
  - `20251126_add_currency_to_products.sql`
  - `20251126_add_products_rls_policies.sql`
  - `20251126_add_role_to_profiles.sql`
  - `20251126_fix_profiles_rls_with_is_admin.sql`
  - `20251130_add_interests_to_profiles.sql`
  - `20251201_add_invite_code_to_profiles.sql`
  - `20251201_create_invites_system.sql`
  - `20251201_fix_invites_rls_for_users.sql`
  - `20251201_fix_invites_update_policy.sql`
  - `20251201_fix_profiles_insert_policy.sql`
  - `20251202_add_whatsapp_to_profiles.sql`
  - `admin_opportunities_policy.sql`
  - `allow_tasks_for_products.sql`
  - `check_and_populate_logs.sql`
  - `check_policy.sql`
  - `check_user_role.sql`
  - `create_get_logs_function.sql`
  - `create_increment_function.sql`
  - `create_links_table.sql`
  - `debug_complete.sql`
  - `debug_opportunity_logs_rls.sql`
  - `debug_rls.sql`
  - `diagnose_logs.sql`
  - `fix_admins_full_control.sql`
  - `fix_invites_policy_final.sql`
  - `fix_invites_policy.sql`
  - `fix_opportunity_logs_rls_for_products.sql`
  - `fix_profiles_constraint.sql`
  - `fix_rls_complete.sql`
  - `rls_admins_only.sql`
  - `tarefas_sistema.sql`
  - `verify_logs_and_tasks.sql`
  - `concierge_folders_table.sql`
  - `concierge_conversations_table.sql`
  - `pedido_requests_table.sql`
  - `concierge_settings_table.sql`
  - `audit_logs_system.sql`

## Atualiza√ß√µes e corre√ß√µes recentes (resumo t√©cnico)

- Reposit√≥rio limpo e enviado ao GitHub (remo√ß√£o de `node_modules` do hist√≥rico, cria√ß√£o de `.gitignore` adequada). Importante: arquivos grandes (ex.: bin√°rios do SWC) impossibilitavam push ‚Äî hist√≥rico reescrito e push for√ßado para `https://github.com/PlayFutnaTela/OFFICINAL-GME.git`.
- Hooks e clientes Supabase corrigidos para serem seguros durante builds/SSR ‚Äî adicionada verifica√ß√£o para `document` antes de acessar cookies no cliente (arquivo: `src/lib/supabase/client.ts`).
- Adicionado `src/app/not-found.tsx` para corrigir falhas no export/static generation que ocorriam em builds na Vercel.
- Corre√ß√µes de tipagem e compatibilidade TypeScript em v√°rios componentes para passar as checagens de tipo durante `next build` (ex.: `src/components/auth-monitor.tsx`, `src/components/ui/avatar.tsx`, `src/components/opportunities-store.tsx`, `src/components/product-list.tsx`).
- Ajustes em componentes com Framer Motion para respeitar tipos e evitar erros de compila√ß√£o (`style/appmenu.tsx`, `style/efeito-sidebar.tsx`).
- Integra√ß√£o com shaders (react-three) tipada via `args` para o `shaderMaterial` (ex.: `style/shader1.tsx`) evitando erros de tipos durante build.
 - Organiza√ß√£o do `style/` com efeitos visuais (carrossel infinito, hover, shader background, gr√°fico Regional HTML).
 - Configura√ß√£o de Tailwind e PostCSS atualizada para suportar o design system.

### Corre√ß√µes do Sistema de Tarefas e Timeline (Novo)

- **Remo√ß√£o de `.single()` em queries Supabase** ‚Äî Corrigido o m√©todo `.single()` que causava erro "Cannot coerce result to a single JSON object" quando retornava arrays. Implementado padr√£o de extra√ß√£o: `const data = Array.isArray(result) ? result[0] : result`.

- **Codifica√ß√£o UTF-8** ‚Äî Recodificado arquivo `src/actions/tasks.ts` para UTF-8 v√°lido, removidos caracteres emoji e especiais problem√°ticos.

- **RLS Policies para Timeline** ‚Äî Implementadas pol√≠ticas de Row Level Security para restringir leitura de logs apenas a usu√°rios com role 'adm'.

- **Fun√ß√£o RPC com SECURITY DEFINER** ‚Äî Criada fun√ß√£o PostgreSQL `get_opportunity_logs()` que contorna RLS de forma segura, permitindo que admins leiam logs sem restri√ß√µes.

- **Verifica√ß√£o de Permiss√µes Ass√≠ncrona** ‚Äî Implementado endpoint `/api/auth/check-admin` e integra√ß√£o no componente `OpportunityTimeline` com handling correto de race conditions (retorna `null` durante verifica√ß√£o).

- **Logging Detalhado** ‚Äî Adicionados console.logs prefixados (ex.: `[functionName]`) em todas as opera√ß√µes de tarefas e logs para facilitar debugging em produ√ß√£o.
 - **Pol√≠ticas de tarefas** ‚Äî Permiss√£o expl√≠cita para associa√ß√£o de tarefas a produtos com `allow_tasks_for_products.sql`.
 - **Diagn√≥stico e verifica√ß√£o** ‚Äî Scripts auxiliares para auditar RLS e logs (`diagnose_logs.sql`, `verify_logs_and_tasks.sql`).

---

## SE√á√ÉO 5: DESIGN SYSTEM FORMALIZADO

### 5.1. Paleta de Cores (Tokens)

```css
/* PRIMARY - Ouro Premium */
--color-gold-50: #FEF9F3
--color-gold-100: #FCF1E3
--color-gold-200: #F9DFC0
--color-gold-300: #F5CB9C
--color-gold-400: #F1B878
--color-gold-500: #C59A00  /* Primary Brand */
--color-gold-600: #9D7A00
--color-gold-700: #755A00
--color-gold-800: #4D3A00

/* SECONDARY - Neutro Elegante */
--color-slate-50: #F8FAFC
--color-slate-100: #F1F5F9
--color-slate-200: #E2E8F0
--color-slate-300: #CBD5E1
--color-slate-400: #94A3B8
--color-slate-500: #64748B
--color-slate-600: #475569
--color-slate-700: #334155
--color-slate-800: #1E293B
--color-slate-900: #0F172A

/* ACCENT - Status e Alertas */
--color-success: #10B981 (Verde)
--color-warning: #F59E0B (Laranja)
--color-error: #EF4444 (Vermelho)
--color-info: #3B82F6 (Azul)

/* SEMANTIC - Membros */
--color-silver: #C0C0C0 (Cinza metalizado)
--color-gold: #FFD700 (Ouro)
--color-black: #1A1A1A (Preto premium)
```

### 5.2. Tipografia

```css
/* Headings */
h1: Poppins Bold 48px / 120%
h2: Poppins Bold 36px / 120%
h3: Poppins SemiBold 28px / 120%
h4: Poppins SemiBold 20px / 120%
h5: Poppins Medium 16px / 120%
h6: Poppins Medium 14px / 120%

/* Body */
Body Large: Inter Regular 16px / 150%
Body Regular: Inter Regular 14px / 150%
Body Small: Inter Regular 12px / 150%

/* Labels */
Label Large: Inter Medium 14px / 150%
Label Regular: Inter Medium 12px / 150%

/* Monospace (para dados t√©cnicos) */
Code: JetBrains Mono 12px / 150%
```

### 5.3. Espa√ßamento (8px Grid)

```
--space-0: 0px
--space-1: 4px (√≠cones pequenos)
--space-2: 8px (default padding interno)
--space-3: 12px
--space-4: 16px (padding padr√£o)
--space-6: 24px (margin entre se√ß√µes)
--space-8: 32px (margin entre componentes maiores)
--space-12: 48px (margin entre grandes √°reas)
--space-16: 64px (margin de se√ß√µes principais)
--space-20: 80px (espa√ßamento de p√°gina)
```

### 5.4. Layout Padr√£o

```
Desktop: 1920px (viewport m√°xima)
Tablet: 1024px
Mobile: 375px (m√≠nimo)

Container max-width: 1440px
Gutter (lateral): 2 x --space-6 (24px)
Coluna: 12 colunas (Tailwind grid)

Breakpoints:
sm: 640px
md: 768px
lg: 1024px
xl: 1280px
2xl: 1536px
```

### 5.5. Componentes Padronizados

#### Card Premium
```tsx
<Card className="bg-white dark:bg-slate-900 rounded-xl shadow-lg hover:shadow-xl transition-shadow border border-gold-200 dark:border-gold-700">
  <CardHeader className="border-b border-gold-100 dark:border-gold-800">
    <CardTitle className="text-gold-900 dark:text-gold-100">T√≠tulo</CardTitle>
  </CardHeader>
  <CardContent className="pt-6">
    {/* conte√∫do */}
  </CardContent>
</Card>
```

#### Badge por N√≠vel
```tsx
/* Silver */
<Badge variant="outline" className="bg-slate-100 text-slate-700 border-slate-300">
  Silver
</Badge>

/* Gold */
<Badge className="bg-gold-100 text-gold-900 border-gold-300">
  Gold
</Badge>

/* Black */
<Badge className="bg-slate-900 text-white border-slate-800">
  Black
</Badge>
```

#### Button Prim√°rio
```tsx
<Button className="bg-gold-500 hover:bg-gold-600 text-white font-medium px-6 py-3 rounded-lg transition-colors">
  A√ß√£o Prim√°ria
</Button>
```

#### Input Premium
```tsx
<Input 
  className="border-gold-300 focus:border-gold-500 focus:ring-gold-500 rounded-lg"
  placeholder="Digite aqui..."
/>
```

### 5.6. Dark Mode
- Implementado via classe `dark` no `html`
- Suporte completo a todo o design system
- Transi√ß√£o suave entre temas (300ms)
- Prefer√™ncia do usu√°rio salva em localStorage

---

## SE√á√ÉO 6: DASHBOARDS DIFERENCIADOS POR TIPO DE USU√ÅRIO

### 6.1. Dashboard do Membro Silver

**Layout:**
- Se√ß√£o 1: Boas-vindas + Status de onboarding
- Se√ß√£o 2: Oportunidades recomendadas (√∫ltimas 3)
- Se√ß√£o 3: Minhas solicita√ß√µes (pedidos abertos)
- Se√ß√£o 4: Como funciona GEREZIM (guia)
- Se√ß√£o 5: Upgradar para Gold (CTA destacado)

**Gr√°ficos:**
- Nenhum gr√°fico t√©cnico (n√£o aplic√°vel em Silver)
- Cards informativos simples
- Timeline de √∫ltimas atividades (leitura)

**Funcionalidades Dispon√≠veis:**
- Visualizar 60% das oportunidades
- Fazer at√© 5 pedidos/m√™s
- Acessar concierge (2h/m√™s)
- Ver perfil pessoal

### 6.2. Dashboard do Membro Gold

**Layout:**
- Se√ß√£o 1: Estat√≠sticas pessoais (visualiza√ß√µes, matches, convers√µes)
- Se√ß√£o 2: Meus Matches (deals que te interessam)
- Se√ß√£o 3: Pedidos Abertos (com status)
- Se√ß√£o 4: Oportunidades Salvas (favoritos)
- Se√ß√£o 5: Hist√≥rico (√∫ltimos 30 dias)

**Gr√°ficos:**
- üìä Categorias mais visualizadas (donut chart)
- üìà Faixa de valor preferida (histogram)
- üó∫Ô∏è Localidades de interesse (geo chart)
- üìâ Taxa de convers√£o pessoal vs m√©dia
- ‚è±Ô∏è Timeline de atividades

**Funcionalidades Dispon√≠veis:**
- Visualizar 100% das oportunidades p√∫blicas
- Acesso a 30% do Black Book
- Matching inteligente 2x/semana
- At√© 20 pedidos/m√™s
- Concierge 8h/m√™s
- An√°lise de viabilidade (unlimited)
- Relat√≥rios de DNA de compra

### 6.3. Dashboard do Membro Black

**Layout:**
- Se√ß√£o 1: Vis√£o Geral Black (headline KPIs)
- Se√ß√£o 2: Black Book (todas as oportunidades privadas)
- Se√ß√£o 3: Gestor de Relacionamento (contato dedicado)
- Se√ß√£o 4: Pedidos Customizados (deal origination)
- Se√ß√£o 5: Due Diligence (arquivos e an√°lises)

**Gr√°ficos:**
- üìä An√°lise detalhada de portfolio (segmenta√ß√£o)
- üìà ROI esperado vs realizado (scatter plot)
- üéØ Pipeline de negocia√ß√£o (Kanban visual)
- üí∞ Distribui√ß√£o de capital (treemap)
- ‚è∞ Timeline de deals (Gantt chart)
- üîê Deals fechados (com confidencialidade)

**Funcionalidades Dispon√≠veis:**
- Acesso 100% ao Black Book
- Deal origination personalizado
- Concierge dedicado 24h
- Due diligence facilitada
- Investment club
- Consultoria estrat√©gica
- Unlimited pedidos
- Prioridade m√°xima

### 6.4. Dashboard Administrativo (Gerenciador/Intermediador)

**Layout:**
- Se√ß√£o 1: KPIs gerenciais (total de membros, deals, comiss√µes)
- Se√ß√£o 2: Pipeline de aprova√ß√µes (membros pendentes)
- Se√ß√£o 3: An√°lise de convers√£o (por deal, por intermediador)
- Se√ß√£o 4: Auditoria (logs de a√ß√µes)
- Se√ß√£o 5: Gest√£o de concierge (workload)

**Gr√°ficos:**
- üìä Membros por n√≠vel (distribui√ß√£o)
- üìà Crescimento de membros (timeline)
- üí∞ Comiss√µes estimadas (por deal)
- üéØ Taxa de convers√£o por deal
- ‚è±Ô∏è Tempo m√©dio para fechamento
- üë• Workload de concierge (horas/dia)
- üîê Auditoria de acessos (quem viu o qu√™)

**Funcionalidades Dispon√≠veis:**
- Criar/editar/deletar oportunidades
- Gerenciar membros e aprova√ß√µes
- Definir n√≠veis de confidencialidade
- Ver an√°lises completas
- Gerenciar concierge
- Auditoria total
- Exportar relat√≥rios
- Integra√ß√£o com webhooks

---

## SE√á√ÉO 7: MELHORIAS DE BACKEND

### 7.1. Separa√ß√£o entre Dados P√∫blicos e Exclusivos

**Nova Tabela: `private_opportunities`**
```sql
CREATE TABLE private_opportunities (
  id UUID PRIMARY KEY,
  title TEXT NOT NULL,
  category TEXT NOT NULL,
  value NUMERIC,
  confidentiality_level TEXT ('gold', 'black'), -- Define acesso
  created_by UUID REFERENCES profiles(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  description TEXT,
  location TEXT,
  images TEXT[],
  status TEXT DEFAULT 'published',
  -- Campos adicionais espec√≠ficos de deals privados
  deal_type TEXT ('acquisition', 'investment', 'partnership'),
  roi_expected NUMERIC,
  timeline TEXT
);

-- RLS Policy: Apenas usu√°rios com membership_tier >= n√≠vel do deal podem ver
```

**Nova Tabela: `private_contacts`**
```sql
CREATE TABLE private_contacts (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  name TEXT NOT NULL,
  contact_info JSONB, -- email, phone, whatsapp (encrypted)
  relationship TEXT, -- 'investor', 'buyer', 'partner', 'strategic'
  net_worth NUMERIC, -- confidencial
  interests TEXT[],
  confidentiality_level TEXT ('internal', 'team', 'admin'),
  created_at TIMESTAMP DEFAULT NOW(),
  -- Auditoria
  last_contacted TIMESTAMP,
  interaction_count INT DEFAULT 0
);

-- RLS Policy: Somente admin e intermediador atribu√≠do podem ver
```

### 7.2. Tabelas para Rastreamento de Comportamento

**Nova Tabela: `user_activities`**
```sql
CREATE TABLE user_activities (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  activity_type TEXT ('view', 'click', 'save', 'share', 'contact', 'deal_closed'),
  entity_type TEXT ('opportunity', 'product', 'deal'),
  entity_id UUID,
  metadata JSONB, -- detalhes adicionais
  created_at TIMESTAMP DEFAULT NOW()
);

-- √çndices para queries r√°pidas
CREATE INDEX idx_user_activities_user_id_type ON user_activities(user_id, activity_type);
CREATE INDEX idx_user_activities_entity ON user_activities(entity_type, entity_id);
```

**Nova Tabela: `user_preferences`**
```sql
CREATE TABLE user_preferences (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  -- Inferred from behavior
  preferred_categories TEXT[],
  preferred_value_range JSONB, -- {min, max}
  preferred_locations TEXT[],
  preferred_deal_types TEXT[],
  -- Expl√≠cito
  notification_frequency TEXT, -- 'daily', 'weekly', 'monthly'
  sharing_permissions JSONB,
  -- Timestamps
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 7.3. Tabelas para IA e Recomenda√ß√µes

**Nova Tabela: `recommendations`**
```sql
CREATE TABLE recommendations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  opportunity_id UUID REFERENCES products(id),
  match_score NUMERIC(3,2), -- 0 a 1.00
  match_reason TEXT, -- "Categoria que voc√™ mais visualiza", etc
  created_at TIMESTAMP DEFAULT NOW(),
  interacted_at TIMESTAMP, -- quando o usu√°rio viu a recomenda√ß√£o
  resulted_in_contact BOOLEAN DEFAULT FALSE
);

-- √çndices
CREATE INDEX idx_recommendations_user_id ON recommendations(user_id, created_at DESC);
```

**Nova Tabela: `valuation_requests`**
```sql
CREATE TABLE valuation_requests (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES profiles(id),
  deal_type TEXT ('company', 'property', 'luxury_car'),
  basic_info JSONB, -- dados b√°sicos (localiza√ß√£o, tamanho, receita)
  documents TEXT[],  -- URLs de uploads
  status TEXT ('pending', 'analyzing', 'completed', 'failed'),
  priority TEXT ('normal', 'urgent'), -- depende do n√≠vel do membro
  assigned_analyst UUID REFERENCES profiles(id),
  result_document TEXT, -- URL do PDF gerado
  created_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP
);
```

### 7.4. Consolida√ß√£o de Migrations

**Estrutura Proposta:**

```
backend/migrations/
‚îú‚îÄ‚îÄ 001_base_schema.sql (cont√©m: users, profiles, opportunities, contacts, etc)
‚îú‚îÄ‚îÄ 002_products_and_categories.sql
‚îú‚îÄ‚îÄ 003_rls_and_security.sql
‚îú‚îÄ‚îÄ 004_tasks_and_timeline.sql
‚îú‚îÄ‚îÄ 005_invites_system.sql
‚îú‚îÄ‚îÄ 006_concierge_system.sql
‚îú‚îÄ‚îÄ 007_private_opportunities.sql (novo)
‚îú‚îÄ‚îÄ 008_user_behavior_tracking.sql (novo)
‚îú‚îÄ‚îÄ 009_ai_recommendations.sql (novo)
‚îú‚îÄ‚îÄ 010_valuation_module.sql (novo)
‚îî‚îÄ‚îÄ 011_fixes_and_optimizations.sql

# Em produ√ß√£o:
-- Antes (multiplos arquivos resolvendo o mesmo problema)
-- Depois (migrations sequenciais e claras)
```

### 7.5. Melhorias de Performance

**√çndices Cr√≠ticos Recomendados:**

```sql
-- Oportunidades
CREATE INDEX idx_products_status_category ON products(status, category);
CREATE INDEX idx_products_created_at_desc ON products(created_at DESC);

-- B√∫sca full-text
ALTER TABLE products ADD COLUMN search_vector tsvector GENERATED ALWAYS AS (
  to_tsvector('portuguese', coalesce(title, '') || ' ' || coalesce(description, ''))
) STORED;
CREATE INDEX idx_products_search ON products USING gin(search_vector);

-- Membership tiers para acesso
CREATE INDEX idx_profiles_membership_tier ON profiles(membership_tier);

-- Auditoria
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at DESC);
```

---

## SE√á√ÉO 8: INTELIG√äNCIA ARTIFICIAL E AUTOMA√á√ÉO

### 8.1. IA Interna (GPT via Server Actions)

**M√≥dulo 1: Gera√ß√£o Autom√°tica de Descri√ß√£o**
```tsx
/* Server Action: src/actions/ai/generate-description.ts */
export async function generateOpportunityDescription(params: {
  category: string,
  basicInfo: string,
  tone: 'formal' | 'casual' | 'premium'
}): Promise<string> {
  // Chama OpenAI API com prompt estruturado
  // Retorna descri√ß√£o otimizada
}

// Uso no formul√°rio:
<Button onClick={() => generateOpportunityDescription({...})}>
  ‚ú® Gerar descri√ß√£o com IA
</Button>
```

**M√≥dulo 2: Avalia√ß√£o Autom√°tica de Risco**
```tsx
export async function assessDealRisk(opportunityId: UUID): Promise<{
  riskScore: number,  // 0-100
  warnings: string[],
  recommendations: string[]
}> {
  // Analisa dados da oportunidade
  // Compara com hist√≥rico
  // Retorna assessment
}
```

**M√≥dulo 3: Classifica√ß√£o Autom√°tica de Lead**
```tsx
export async function scoreLead(memberId: UUID): Promise<{
  leadScore: number,    // 0-100
  propensityToBuy: number,
  avgDealSize: number,
  preferredCategories: string[]
}> {
  // Analisa behavior do membro
  // Calcula score de probabilidade
  // Retorna insights
}
```

**M√≥dulo 4: IA Concierge para Pr√©-Atendimento**
```tsx
export async function aiConciergeResponse(message: string): Promise<string> {
  // Membro Black pergunta algo
  // IA tenta responder (FAQ, dados p√∫blicos)
  // Se complexo: escalona para human
}
```

### 8.2. Assistente Proativo

**Notifica√ß√µes Inteligentes (Server-side job):**

```tsx
// Job rodando a cada 1h (Vercel Cron ou externa)
export async function runProactiveAssistant() {
  // Busca membros com:
  // - Oportunidades salvas h√° 10+ dias sem a√ß√£o
  // - Matching score alto mas sem abertura do deal
  // - Pedidos pendentes h√° 15+ dias
  
  // Envia notifica√ß√£o personalizada:
  // "Jo√£o, encontramos 3 deals que combinam com seu perfil"
  // "Seu pedido de im√≥vel em SP est√° quase pronto!"
}
```

---

## SE√á√ÉO 9: ROADMAP PRIORIZADO

### Fase 1 ‚Äì Fechar o MVP Premium (Q1 2025)

**Objetivo:** Estabelecer funda√ß√£o de um clube exclusivo funcional

- [ ] Design System formalizado (tokens, componentes, guias)
- [ ] Dashboard diferenciado por tipo de usu√°rio
- [ ] Matching inteligente b√°sico (regra + IA simples)
- [ ] √Årea privada de oportunidades (Gold/Black Book)
- [ ] Onboarding com convite + aprova√ß√£o (refinado)
- [ ] Mobile-first otimizado completo

**Deliverables:**
- Guia de componentes (Storybook ou Figma)
- 3 dashboards funcionales
- Algoritmo de matching testado
- Pol√≠tica RLS para private_opportunities
- App mobile com 95% de funcionalidades

### Fase 2 ‚Äì Clube Privado Premium (Q2 2025)

**Objetivo:** Virar um clube verdadeiro com tiers e perks reais

- [ ] Planos Silver/Gold/Black operacionais (billing integrado)
- [ ] Concierge avan√ßado com automa√ß√£o (chatbot + human handoff)
- [ ] Deals off-market 100% privado
- [ ] IA Concierge + sugest√µes autom√°ticas
- [ ] Valuation express integrado (com analistas)
- [ ] Hist√≥rico de comportamento / DNA de compra
- [ ] Rate limiting e prote√ß√£o contra spam

**Deliverables:**
- Stripe/PagSeguro integrado
- Chatbot com OpenAI
- 50+ deals privados curados
- Relat√≥rios de valuation autom√°ticos
- Sistema de scoring de leads

### Fase 3 ‚Äì Marketplace High Ticket Inteligente (Q3-Q4 2025)

**Objetivo:** Escalar para ser o maior clube de deals privados do Brasil

- [ ] Automa√ß√£o completa de leads (scoring, matching, outreach)
- [ ] Recomenda√ß√µes autom√°ticas baseadas em comportamento
- [ ] Notifica√ß√µes de "matching" em tempo real
- [ ] M√≥dulo de an√°lise de viabilidade completo
- [ ] Deal flow organizado por origem e intermediador
- [ ] Analytics avan√ßadas (para admins e membros Black)
- [ ] Integra√ß√µes com sistemas externos (Zapier, Make, etc)

**Deliverables:**
- 1000+ membros ativos
- 100+ intermediadores
- 500+ deals em pipeline
- Dashboard com 20+ m√©tricas
- API p√∫blica para parceiros

---

## SE√á√ÉO 10: FUNCIONALIDADES AINDA FALTANDO

### 10.1. Visualiza√ß√£o Premium de Oportunidades

**Nova se√ß√£o: /oportunidades/[id]**

```tsx
// Hero section com fotos em carrossel
<HeroCarousel images={opportunity.images} />

// Info premium
<div className="grid grid-cols-3 gap-6">
  <PriceCard value={opportunity.value} currency="BRL" />
  <LocationCard location={opportunity.location} mapUrl="..." />
  <ConfidentialityBadge level={opportunity.confidentiality} />
</div>

// Timeline de valores (hist√≥rico)
<PriceTimeline />

// Documentos e an√°lises
<DocumentSection documents={opportunity.documents} />

// Contato com intermediador
<IntermediadorCard intermediador={opportunity.created_by} />

// Bot√µes de a√ß√£o por n√≠vel
{membership === 'black' && <Button>Solicitar DD</Button>}
{membership === 'gold' && <Button>Solicitar Apresenta√ß√£o</Button>}
{membership === 'silver' && <Button>Upgrade para Ouro</Button>}
```

### 10.2. Rate Limiting

```tsx
// Middleware: src/middleware.ts
export async function middleware(request: NextRequest) {
  const ip = request.ip || 'unknown'
  const limit = 100 // requisi√ß√µes por hora
  
  const count = await redis.incr(`rate-limit:${ip}`)
  if (count > limit) {
    return new NextResponse('Too Many Requests', { status: 429 })
  }
  
  return NextResponse.next()
}
```

### 10.3. Mobile App

- React Native ou Flutter
- Funcionalidades core: listar oportunidades, salvar, compartilhar, chat
- Push notifications
- Biometria para seguran√ßa
- Camera para scan de QR codes

---

## SE√á√ÉO 11: OBSERVA√á√ïES T√âCNICAS FINAIS

### Build & Deploy

- `npm run build` deve passar sem warnings
- TypeScript strict mode ativado
- Tests rodam em CI/CD (implementar)
- Vercel configurado com vari√°veis de ambiente
- Supabase em produ√ß√£o com backups di√°rios

### Escalabilidade

- Database: PostgreSQL escala bem at√© 1M+ registros (com √≠ndices corretos)
- Cache com Redis para queries frequentes (recomendado em Q2)
- CDN para assets est√°ticos (j√° configurado via Vercel)
- Rate limiting e DDoS protection via Vercel ou Cloudflare

### Seguran√ßa

- RLS obrigat√≥rio em todas as tabelas
- Tokens JWT com validade curta (15min)
- Refresh tokens com maior validade (7 dias)
- Audit logs de todas as a√ß√µes administrativas
- Criptografia de dados sens√≠veis (contatos, CPF, net worth)

---

**Documento revisado em:** 8 de dezembro de 2025
**Status:** Pronto para implementa√ß√£o

#### 1. `opportunities` (Oportunidades)
- `id`: UUID (chave prim√°ria)
- `user_id`: UUID (refer√™ncia para auth.users) - seguran√ßa baseada em usu√°rio
- `title`: Texto (t√≠tulo da oportunidade)
- `category`: Texto (valores permitidos: 'carro', 'imovel', 'empresa', 'item_premium')
- `value`: Num√©rico (valor da oportunidade)
- `description`: Texto (descri√ß√£o detalhada)
- `photos`: Array de textos (URLs das fotos armazenadas no Supabase Storage)
- `location`: Texto (localiza√ß√£o do item)
- `status`: Texto (valores: 'novo', 'em_negociacao', 'vendido')
- `pipeline_stage`: Texto (valores: 'Novo', 'Interessado', 'Proposta enviada', 'Negocia√ß√£o', 'Finalizado')
- `created_at`: Timestamp com fuso hor√°rio

#### 2. `contacts` (Clientes)
- `id`: UUID (chave prim√°ria)
- `user_id`: UUID (refer√™ncia para auth.users)
- `name`: Texto (nome do contato)
- `phone`: Texto (telefone do contato)
- `source`: Texto (origem do contato)
- `interests`: Texto (interesses do contato)
- `status`: Texto (valores: 'novo', 'quente', 'morno', 'frio')
- `created_at`: Timestamp com fuso hor√°rio

#### 3. `interactions` (Intera√ß√µes)
- `id`: UUID (chave prim√°ria)
- `contact_id`: UUID (refer√™ncia para contacts, com delete cascade)
- `content`: Texto (descri√ß√£o da intera√ß√£o)
- `created_at`: Timestamp com fuso hor√°rio

#### 4. `tasks` (Tarefas) [NOVO]
- `id`: UUID (chave prim√°ria)
- `user_id`: UUID (refer√™ncia para auth.users)
- `opportunity_id`: UUID (refer√™ncia para opportunities ou products, flex√≠vel)
- `title`: Texto (t√≠tulo da tarefa)
- `description`: Texto (descri√ß√£o detalhada)
- `status`: Texto (valores: 'novo', 'em_progresso', 'concluida', 'atrasada')
- `priority`: Texto (valores opcionais: 'baixa', 'm√©dia', 'alta')
- `due_date`: Timestamp (data de vencimento)
- `created_at`: Timestamp com fuso hor√°rio
- `updated_at`: Timestamp com fuso hor√°rio

#### 5. `opportunity_logs` (Registro de Atividades) [NOVO]
- `id`: UUID (chave prim√°ria)
- `opportunity_id`: UUID (refer√™ncia para opportunities)
- `user_id`: UUID (refer√™ncia para auth.users)
- `message`: Texto (descri√ß√£o da atividade)
- `created_at`: Timestamp com fuso hor√°rio

**RLS Policies:**
- Leitura restrita a usu√°rios com role 'adm' (verificado via fun√ß√£o `public.is_admin()`)
- Cria√ß√£o de logs permitida para todas opera√ß√µes do sistema
- Fun√ß√£o RPC `get_opportunity_logs(p_opportunity_id UUID)` com SECURITY DEFINER para contorno seguro de RLS
 
 #### 6. `profiles` (Perfis) [ATUALIZADO]
 - Campos adicionais: `role` (admin/usuario), `invite_code`, `whatsapp`, `interests`
 - Pol√≠ticas corrigidas para inser√ß√£o e leitura segura, com checks de admin.
 
 #### 7. `links` (Links compartilh√°veis) [NOVO]
 - Tabela criada por `create_links_table.sql` para gerenciamento de links externos.
 
 #### 8. `products` (Produtos) [ATUALIZADO]
 - Campo `currency` adicionado, RLS ajustadas para leitura/associa√ß√£o com tarefas.

#### 9. `invites` (Convites) [NOVO]
- `id`: UUID (chave prim√°ria)
- `code`: Texto (c√≥digo √∫nico do convite no formato GZM-XXXXX)
- `created_by`: UUID (usu√°rio que criou o convite)
- `status`: Texto (status do convite: 'unused', 'used')
- `category`: Texto (categoria do convite: 'standard', etc.)
- `max_uses`: Inteiro (n√∫mero m√°ximo de usos permitidos)
- `times_used`: Inteiro (contador de usos)
- `notes`: Texto (notas adicionais sobre o convite)
- `created_at`: Timestamp (data de cria√ß√£o)
- `used_by`: UUID (usu√°rio que utilizou o convite)
- `used_at`: Timestamp (data de utiliza√ß√£o)
- `expires_at`: Timestamp (data de expira√ß√£o opcional)
- `created_by_profile`: UUID (perfil do criador)
- `invite_type`: Texto (tipo do convite)

#### 10. `pending_members` (Membros Pendentes) [NOVO]
- `id`: UUID (chave prim√°ria)
- `invite_code`: Texto (c√≥digo do convite utilizado)
- `name`: Texto (nome do candidato)
- `phone`: Texto (telefone do candidato)
- `email`: Texto (email do candidato)
- `status`: Texto (status: 'pending', 'approved', 'rejected')
- `extra_info`: JSON (informa√ß√µes adicionais)
- `reviewed_by`: UUID (usu√°rio que revisou)
- `reviewed_at`: Timestamp (data de revis√£o)
- `rejection_reason`: Texto (motivo da rejei√ß√£o)
- `applied_at`: Timestamp (data da aplica√ß√£o)

#### 11. `audit_logs` (Logs de Auditoria) [NOVO]
- `id`: UUID (chave prim√°ria)
- `action`: Texto (a√ß√£o realizada)
- `table_name`: Texto (nome da tabela)
- `record_id`: UUID (ID do registro)
- `old_values`: JSON (valores antigos)
- `new_values`: JSON (novos valores)
- `user_id`: UUID (usu√°rio que realizou a a√ß√£o)
- `ip_address`: Texto (endere√ßo IP)
- `user_agent`: Texto (user agent)
- `timestamp`: Timestamp (data da a√ß√£o)

#### 12. `concierge_folders` (Pastas de Concierge) [NOVO]
- `id`: UUID (chave prim√°ria)
- `name`: Texto (nome da pasta)
- `description`: Texto (descri√ß√£o da pasta)
- `position`: Inteiro (ordem de exibi√ß√£o)
- `user_id`: UUID (usu√°rio propriet√°rio)
- `created_at`: Timestamp (data de cria√ß√£o)

#### 13. `concierge_conversations` (Conversas de Concierge) [NOVO]
- `id`: UUID (chave prim√°ria)
- `folder_id`: UUID (pasta de origem)
- `title`: Texto (t√≠tulo da conversa)
- `description`: Texto (descri√ß√£o)
- `status`: Texto (status da conversa)
- `assigned_to`: UUID (usu√°rio atribu√≠do)
- `created_at`: Timestamp (data de cria√ß√£o)
- `updated_at`: Timestamp (data de atualiza√ß√£o)

#### 14. `concierge_settings` (Configura√ß√µes de Concierge) [NOVO]
- `id`: UUID (chave prim√°ria)
- `key`: Texto (chave da configura√ß√£o)
- `value`: Texto (valor da configura√ß√£o)
- `description`: Texto (descri√ß√£o)
- `updated_at`: Timestamp (data de atualiza√ß√£o)

#### 15. `pedido_requests` (Solicita√ß√µes de Pedidos) [NOVO]
- `id`: UUID (chave prim√°ria)
- `user_id`: UUID (usu√°rio que solicitou)
- `title`: Texto (t√≠tulo do pedido)
- `description`: Texto (descri√ß√£o do pedido)
- `category`: Texto (categoria do pedido)
- `status`: Texto (status: 'pending', 'in_progress', 'completed', 'rejected')
- `created_at`: Timestamp (data de cria√ß√£o)
- `updated_at`: Timestamp (data de atualiza√ß√£o)
- `assigned_to`: UUID (usu√°rio atribu√≠do)
- `response`: Texto (resposta fornecida)

## Seguran√ßa e Permiss√µes

O sistema utiliza Row Level Security (RLS) do Supabase para garantir que:

1. Usu√°rios s√≥ possam ver, editar ou excluir seus pr√≥prios dados
2. Oportunidades podem ser vistas publicamente (importante para listagem)
3. Apenas propriet√°rios podem fazer altera√ß√µes em seus registros
4. Intera√ß√µes est√£o vinculadas aos contatos e, por extens√£o, ao usu√°rio
5. Acesso a imagens √© controlado (upload por autenticados, leitura p√∫blica)
 6. Verifica√ß√£o ass√≠ncrona de admin via API (`/api/auth/check-admin`) e fun√ß√£o `public.is_admin()`
 7. RPC com SECURITY DEFINER para leitura administrativa de logs

## Funcionalidades do Sistema

### 1. Autentica√ß√£o e Autoriza√ß√£o
- Login por e-mail/senha via Supabase Auth
- Sess√£o persistente
- Seguran√ßa baseada em RLS para proteger dados de cada usu√°rio
- Registro de novos usu√°rios com valida√ß√£o de c√≥digo de convite
- Recupera√ß√£o de senha com tokens tempor√°rios
- Sistema de aprova√ß√£o de novos membros com fluxo administrativo
- Perfis com diferentes n√≠veis de acesso (usu√°rio/admin)
- Armazenamento de informa√ß√µes adicionais nos perfis (interesses, WhatsApp)

### 2. Dashboard
- Vis√£o geral com m√©tricas resumidas:
  - Total de Oportunidades
  - Contatos Ativos
  - Volume em Negocia√ß√£o
  - Volume Total
- Gr√°ficos interativos com Google Charts:
  - Taxa de Convers√£o por Est√°gio do Funil
  - Valor M√©dio por Oportunidade por Categoria
  - Distribui√ß√£o de Oportunidades por Valor
  - Produtos Mais Vendidos
  - Oportunidades por Categoria (gr√°fico de pizza)
  - Top 5 produtos mais caros
  - Evolu√ß√£o no Faturamento
  - Pipeline de Vendas
- Sele√ß√£o de per√≠odo para an√°lise (7d, 30d, 90d, 365d)
- Tooltips explicativos para todos os gr√°ficos

### 3. Gest√£o de Oportunidades
- Listagem de oportunidades de neg√≥cios
- Cadastro de oportunidades com:
  - T√≠tulo, categoria, valor
  - Descri√ß√£o e localiza√ß√£o
  - Fotos (armazenadas no Supabase Storage)
  - Status e est√°gio no pipeline
- Filtros e ordena√ß√£o
- Integra√ß√£o com WhatsApp para compartilhamento
 - Suporte a links p√∫blicos com `links` e pol√≠ticas adequadas

### 4. Gest√£o de Clientes
- Cadastro e visualiza√ß√£o de clientes
- Classifica√ß√£o por status (quente, morno, frio)
- Hist√≥rico de intera√ß√µes
- Cadastro de novos clientes

### 5. Pipeline de Vendas
- Visualiza√ß√£o Kanban com os est√°gios:
  - Novo
  - Interessado
  - Proposta enviada
  - Em Negocia√ß√£o
  - Finalizado
- Drag & drop entre est√°gios (potencialmente implementado)
- Acompanhamento visual do fluxo de vendas

### 6. Relat√≥rios
- M√©tricas de desempenho:
  - Total vendido
  - Comiss√£o estimada
  - Itens vendidos vs total
- An√°lise de desempenho de vendas
- C√°lculo de comiss√µes (exemplo com 5%)

### 7. Produtos
- Gest√£o de cat√°logo de produtos
- Informa√ß√µes como t√≠tulo, subt√≠tulo, pre√ßo, comiss√£o
- Controle de estoque
- Categoriza√ß√£o
 - Moeda configur√°vel por produto

### 8. Integra√ß√µes
- Supabase Storage para imagens
- Integra√ß√£o com WhatsApp para compartilhamento de oportunidades
- Google Charts para visualiza√ß√£o de dados
- Supabase Auth para autentica√ß√£o
 - RPCs e Server Actions para opera√ß√µes seguras
 - Sonner para feedback instant√¢neo ao usu√°rio
 - Radix UI e Shadcn para acessibilidade e consist√™ncia visual
 - React Three Fiber para efeitos visuais diferenciados
 - Resend para envio de emails automatizados
 - Webhooks para integra√ß√£o com Discord/Make e outros servi√ßos
 - @dnd-kit para funcionalidades de arrastar e soltar
 - Navega√ß√£o responsiva com mobile menu
 - Componentes de sidebar e topbar com anima√ß√µes
 - Design mobile-first com suporte a todos os dispositivos

### 9. Sistema de Tarefas e Timeline (Novo)
- Gest√£o de tarefas associadas a oportunidades/produtos:
  - Cria√ß√£o, edi√ß√£o e exclus√£o de tarefas
  - Atribui√ß√£o de status (novo, em progresso, conclu√≠da, atrasada)
  - Rastreamento autom√°tico de mudan√ßas de status
- Timeline de atividades (Linha do Tempo):
  - Registro autom√°tico de eventos: cria√ß√£o de tarefas, conclus√£o de tarefas, remo√ß√£o de tarefas, altera√ß√µes de status
  - Visibilidade restrita a usu√°rios com role 'adm' (administrador)
  - Tooltips informativos explicando quais atividades s√£o registradas
  - Timestamps com formata√ß√£o de tempo relativo (minutos, horas, dias)
- Logging centralizado via Server Actions com tratamento de erros robusto
- API endpoint `/api/auth/check-admin` para verifica√ß√£o ass√≠ncrona de permiss√µes
 - Associa√ß√£o de tarefas a oportunidades e produtos
 - Filtros por status e ordena√ß√£o
 - A√ß√µes com feedback via toasts

### 10. Sistema de Convites Privados (Novo)
- Gera√ß√£o de c√≥digos de convite exclusivos para acesso premium:
  - Cria√ß√£o de convites com categorias e limites de uso
  - Controle de uso (quantidade de utiliza√ß√µes)
  - Hist√≥rico de utiliza√ß√£o e status (usado, n√£o usado)
- P√°gina p√∫blica de solicita√ß√£o de convite:
  - Formul√°rio com campos: nome, email, WhatsApp, motivo da solicita√ß√£o
  - Valida√ß√£o de c√≥digo de convite
  - Processo de cadastro com informa√ß√µes do candidato
- Aprova√ß√£o administrativa de candidatos:
  - Painel de administra√ß√£o para revis√£o de solicita√ß√µes
  - Aprova√ß√£o/rejei√ß√£o com motivos
  - Cria√ß√£o autom√°tica de contas para candidatos aprovados
  - Envio autom√°tico de emails com credenciais tempor√°rias
- Sistema de auditoria:
  - Registro de todas as opera√ß√µes (cria√ß√£o de convites, solicita√ß√µes, aprova√ß√µes)
  - Log de a√ß√µes administrativas
- Integra√ß√£o com webhook:
  - Notifica√ß√µes para canais externos (Discord, Make, etc.)
  - Integra√ß√£o com servi√ßos de email (Resend)
- Controle de perfis:
  - Armazenamento de c√≥digo de convite de origem
  - Armazenamento de informa√ß√µes adicionais de interesse
  - Contato de WhatsApp no perfil do usu√°rio

### 11. Sistema de Concierge (Novo)
- Painel administrativo exclusivo para suporte premium:
  - Interface de gerenciamento de conversas e clientes
  - Sistema de pastas organizacionais para categoriza√ß√£o
  - Configura√ß√µes de webhook para integra√ß√µes externas
  - Atribui√ß√£o de conversas a perfis de administradores
- Gerenciamento de conversas:
  - Cria√ß√£o e organiza√ß√£o de conversas por cliente
  - Hist√≥rico de intera√ß√µes
  - Organiza√ß√£o por pastas e categorias
- Integra√ß√µes externas:
  - Configura√ß√£o de URLs de webhook para notifica√ß√µes
  - Integra√ß√£o com sistemas externos de atendimento
- Acesso restrito:
  - Dispon√≠vel apenas para usu√°rios com role 'adm'

### 12. Sistema de Solicita√ß√£o de Pedidos/Produtos (Novo)
- Interface para solicita√ß√£o de produtos/servi√ßos espec√≠ficos:
  - Formul√°rio para solicita√ß√£o de itens n√£o dispon√≠veis na plataforma
  - Sistema de solicita√ß√µes com status de acompanhamento
  - Painel administrativo para gerenciamento de solicita√ß√µes
  - Funcionalidades CRUD para gerenciamento de pedidos

### Observa√ß√µes de Build / Deploy (Vercel)

- O projeto roda em Next.js 14 ‚Äî Vercel executa `npm run build` em cada deploy e precisa das vari√°veis p√∫blicas do Supabase definidas na interface da Vercel.  Configurar **exatamente**: `NEXT_PUBLIC_SUPABASE_URL` e `NEXT_PUBLIC_SUPABASE_ANON_KEY` (valores p√∫blicos do projeto supabase) para `Preview` e `Production`.
- Evite comitar `node_modules` e arquivos build (`.next`) ‚Äî eles foram removidos do hist√≥rico do repo e listados no `.gitignore`.
- Teste o build localmente antes do push: `npm run build` ‚Äî durante desenvolvimento verifique mensagens sobre SSR (ex.: `document is not defined`) que indicam c√≥digo que toca `window`/`document` no lado do servidor.
 - Verifique clientes Supabase SSR (`@supabase/ssr`) e guards em `src/lib/supabase/client.ts`.
 - Mantenha vari√°veis de ambiente em Vercel para Preview/Production, com regi√µes pr√≥ximas ao Supabase.

## Boas pr√°ticas e recomenda√ß√µes (deploy / infra)

- Em ambientes serverless (Vercel) prefira clientes Supabase que funcionem no servidor ou proteja acessos dependentes do DOM (cookies/`localStorage`) com guards ‚Äî isso evita erros durante a exporta√ß√£o/prerender.
- Mantenha a regi√£o das Functions na Vercel pr√≥xima ou igual √† regi√£o do Supabase para reduzir lat√™ncia entre fun√ß√µes e banco.
- Para arquivos grandes ou bin√°rios nativos (p.ex.: `next-swc` em `node_modules`), n√£o mantenha vers√µes bin√°rias no hist√≥rico do Git ‚Äî use `.gitignore` e Git LFS se precisar armazenar arquivos maiores que 100MB.
 - Utilize scripts SQL de diagn√≥stico para validar pol√≠ticas RLS em ambientes novos antes do tr√°fego real.
 - Centralize logs cr√≠ticos via RPC para auditoria administrativa quando necess√°rio.

## Caracter√≠sticas T√©cnicas

### Padr√µes de C√≥digo
- TypeScript para tipagem est√°tica
- Componentes React reutiliz√°veis
- Uso de Server Components para opera√ß√µes que requerem autentica√ß√£o
- Client Components para interatividade
- Componentes UI acess√≠veis via Radix UI e Shadcn
 - Efeitos 3D e shaders customizados quando aplic√°vel
 - Toasts para feedback de usu√°rio em a√ß√µes sens√≠veis

### Performance e Escalabilidade
- Uso de Server Actions para opera√ß√µes que requerem autentica√ß√£o
- Fetch otimizado no servidor para dados protegidos
- Lazy loading potencial nos componentes
- CDN para assets est√°ticos via Next.js
 - SSR com guards para evitar acesso indevido ao `window`/`document`

### Seguran√ßa
- RLS configurado no Supabase para isolamento de dados por usu√°rio
- Autentica√ß√£o centralizada via Supabase
- Prote√ß√£o contra acesso n√£o autorizado
- Valida√ß√£o de dados no banco de dados
 - Verifica√ß√£o e logs administrativos com seguran√ßa refor√ßada

### Design e Usabilidade
- Interface responsiva com Tailwind CSS
- Design moderno e limpo
- Componentes acess√≠veis
- Anima√ß√µes suaves com Framer Motion
- Gr√°ficos interativos com tooltips explicativos
 - √çcones consistentes com Lucide
 - Carrossel e efeitos de hover/customiza√ß√£o no `style/`
 - Efeitos 3D com react-three-fiber e three.js
 - Shaders personalizados para backgrounds e efeitos visuais
 - Componentes de UI avan√ßados com @ark-ui/react
 - Carrossel de banners e imagens com efeitos especiais
 - Efeitos de sidebar e menu com anima√ß√µes personalizadas
 - Componentes de upload de avatar com preview
 - Layout responsivo com mobile-first approach
 - Componentes de formul√°rio acess√≠veis com Radix UI
 - Feedback visual com Sonner para notifica√ß√µes
 - Efeitos hover e intera√ß√µes com Framer Motion

## Recursos Implementados

### Dashboard Avan√ßado
- 8 tipos diferentes de gr√°ficos
- Anima√ß√µes fluidas e transi√ß√µes suaves
- Tooltips explicativos em todos os gr√°ficos
- Sele√ß√£o din√¢mica de per√≠odo
- Dados em tempo real do banco de dados

### P√°ginas e Funcionalidades Adicionais
- P√°gina p√∫blica de solicita√ß√£o de convite com formul√°rio completo
- P√°gina de valida√ß√£o de convite com processo de cadastro
- P√°gina de concierge exclusiva para administradores
- P√°gina de solicita√ß√£o de pedidos/produtos
- Painel administrativo para gerenciamento de convites
- Sistema de aprova√ß√£o de membros com fluxo completo
- Gerenciamento de perfis com edi√ß√£o de informa√ß√µes
- Sistema de categorias e produtos
- Gerenciamento de links compartilh√°veis
- Funcionalidades de favoritos
- Sistema de insumos e categorias
- Componentes de upload de imagens com preview
- Modal de cria√ß√£o e edi√ß√£o de oportunidades
- Modal de compartilhamento via WhatsApp
- Sistema de recupera√ß√£o de senha
- Formul√°rio de registro com valida√ß√£o de convite
- Gerenciamento de tarefas com diferentes status
- Timeline de atividades com logs detalhados

### Gr√°ficos Espec√≠ficos
1. **Taxa de Convers√£o por Est√°gio do Funil**
   - Calcula e exibe a porcentagem de convers√£o entre est√°gios
   - Mostra efici√™ncia do processo de vendas

2. **Valor M√©dio por Oportunidade por Categoria**
   - Calcula m√©dias de valor para cada categoria
   - Ajuda a identificar categorias mais valiosas

3. **Distribui√ß√£o de Oportunidades por Valor**
   - Agrupa oportunidades em faixas de valor
   - Fornece vis√£o do perfil das negocia√ß√µes

4. **Produtos Mais Vendidos**
   - Conta oportunidades finalizadas por produto
   - Mostra os produtos mais populares

5. **Oportunidades por Categoria** (gr√°fico de pizza)
   - Distribui√ß√£o percentual das oportunidades

6. **Top 5 produtos mais caros**
   - Lista os produtos com maiores valores

7. **Evolu√ß√£o no Faturamento**
   - Gr√°fico de linhas com hist√≥rico de vendas

8. **Pipeline de Vendas**
   - Visualiza√ß√£o horizontal do funil de vendas

## Arquivos e Configura√ß√µes

### Vari√°veis de Ambiente
- `NEXT_PUBLIC_SUPABASE_URL` - URL do projeto Supabase
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Chave an√¥nima do Supabase

### Arquivos Modificados e Criados Recentemente (Sistema de Tarefas)

#### Server Actions (`src/actions/`)
- **`tasks.ts`** (337 linhas) - Opera√ß√µes CRUD para tarefas
  - `getTasks(opportunity_id)` - Buscar tarefas de uma oportunidade/produto
  - `getAllTasks()` - Listar todas as tarefas do usu√°rio ou todas se admin
  - `createTask()` - Criar nova tarefa e registrar no log
  - `updateTask()` - Atualizar dados da tarefa
  - `updateTaskStatus()` - Atualizar status e criar log de conclus√£o
  - `deleteTask()` - Deletar tarefa e registrar no log
  - `getTasksWithOpportunities()` - Listar tarefas com dados relacionados

- **`logs.ts`** (125 linhas) - Gerenciamento de logs de atividades
  - `createLog(opportunity_id, message)` - Criar registro de atividade
  - `getOpportunityLogs(opportunity_id)` - Buscar logs de uma oportunidade (admin only)
  - `getRecentLogs(limit)` - Buscar logs recentes (admin only)
  - Implementa√ß√£o com RPC fallback para tratamento de RLS

#### Componentes (`src/components/`)
- **`opportunity-timeline.tsx`** (248 linhas) - [NOVO] Linha do tempo de atividades
  - Exibe registro de cria√ß√£o, conclus√£o e remo√ß√£o de tarefas
  - Restrito a usu√°rios com role 'adm'
  - Tooltip explicativo com √≠cone de ajuda
  - Timestamps com formata√ß√£o relativa (minutos, horas, dias)
  - √çcones diferenciados por tipo de atividade
  - Verifica√ß√£o ass√≠ncrona de permiss√µes sem race conditions
    - Integra√ß√£o com Sonner para feedback

- **`task-form.tsx`** - [NOVO] Formul√°rio para criar/editar tarefas
  - Campos: t√≠tulo, descri√ß√£o, status, prioridade, data de vencimento
  - Valida√ß√£o de dados
  - Integra√ß√£o com Server Actions

- **`task-list.tsx`** - [NOVO] Lista de tarefas
  - Exibi√ß√£o de tarefas por oportunidade
  - Filtros por status
  - A√ß√µes: editar, deletar, mudar status

- **`task-status-dropdown.tsx`** - [NOVO] Seletor de status de tarefa
  - Dropdown com op√ß√µes de status
  - Integra√ß√£o com `updateTaskStatus()`

#### API Routes (`src/app/api/`)
- **`auth/check-admin/route.ts`** (29 linhas) - [NOVO] Endpoint para verificar role
  - GET `/api/auth/check-admin`
  - Retorna `{ isAdmin: boolean }`
  - Consulta role do usu√°rio na tabela `profiles`

#### Migrations SQL (`backend/migrations/`)
- **`rls_admins_only.sql`** - Pol√≠ticas RLS para logs
  - Policy de leitura: apenas admins podem ler logs
  - Policy de cria√ß√£o: sistema pode criar logs livremente

- **`create_get_logs_function.sql`** - Fun√ß√£o RPC para contorno seguro de RLS
  - `get_opportunity_logs(p_opportunity_id UUID)`
  - SECURITY DEFINER para bypass de RLS
  - Retorna logs com nomes de usu√°rios via LEFT JOIN
 - **`allow_tasks_for_products.sql`** - Permite vincular tarefas a produtos
 - **`check_and_populate_logs.sql`** - Rotina para checagem/preenchimento de logs
 - **`verify_logs_and_tasks.sql`** - Verifica√ß√µes de integridade dos logs e tarefas

### Scripts Dispon√≠veis
- `npm run dev` - Iniciar servidor de desenvolvimento
- `npm run build` - Criar build de produ√ß√£o
- `npm run start` - Iniciar servidor de produ√ß√£o
- `npm run lint` - Executar linter
 - (Opcional) `npm run typecheck` - Validar tipos durante CI/CD

## Considera√ß√µes e Recomenda√ß√µes

### Pontos Fortes
- Arquitetura bem definida com separa√ß√£o clara de responsabilidades
- Seguran√ßa implementada com RLS no banco de dados
- Interface moderna e responsiva
- Dashboard completo com m√∫ltiplas visualiza√ß√µes
- Integra√ß√£o com servi√ßos externos (Supabase, WhatsApp)
- Tipagem est√°tica com TypeScript
- **[NOVO]** Sistema de tarefas com logging autom√°tico de atividades
- **[NOVO]** Timeline administrativo com registro detalhado de opera√ß√µes
- **[NOVO]** Controle de acesso baseado em roles com verifica√ß√£o ass√≠ncrona
 - **[NOVO]** Efeitos visuais 3D e shaders customizados
 - **[NOVO]** Feedback consistente com toasts (Sonner)
 - **[NOVO]** Pol√≠ticas RLS abrangentes com scripts de diagn√≥stico
 - **[NOVO]** Integra√ß√£o de links compartilh√°veis e associa√ß√£o de tarefas a produtos
 - **[NOVO]** Sistema completo de convites privados com aprova√ß√£o administrativa
 - **[NOVO]** Sistema de auditoria e logs detalhados de todas as opera√ß√µes
 - **[NOVO]** Integra√ß√£o com servi√ßos de email (Resend) para comunica√ß√µes automatizadas
 - **[NOVO]** Sistema de concierge para suporte premium com atribui√ß√£o de conversas
 - **[NOVO]** Funcionalidade de solicita√ß√£o de pedidos/produtos com acompanhamento
 - **[NOVO]** Webhooks e integra√ß√µes com servi√ßos externos (Discord, Make, etc.)
 - **[NOVO]** Sistema completo de aprova√ß√£o de membros com fluxo de revis√£o
 - **[NOVO]** Drag and drop e interface avan√ßada com @dnd-kit

### Melhorias Potenciais
- Implementa√ß√£o de testes unit√°rios e de integra√ß√£o para Server Actions
- Adi√ß√£o de funcionalidades de notifica√ß√£o em tempo real para mudan√ßas de tarefas
- Sistema de relat√≥rios mais avan√ßado com exporta√ß√£o de logs de atividades
- Integra√ß√£o com calend√°rio para agendamentos de tarefas
- Funcionalidades de colabora√ß√£o para equipes (atribui√ß√£o de tarefas a outros usu√°rios)
- Filtros avan√ßados na timeline (por tipo de atividade, data, usu√°rio)
- Exporta√ß√£o de timeline como PDF/CSV para auditoria
- Sistema de permiss√µes mais granular al√©m de admin/n√£o-admin
 - Monitoramento de performance dos shaders e fallback para dispositivos mais simples
 - CI/CD com typecheck e valida√ß√µes de build em PRs

### Escalabilidade
- O sistema est√° bem estruturado para escalar horizontalmente
- Uso de Supabase facilita o gerenciamento de banco de dados
- Componentes modulares permitem adi√ß√£o de novas funcionalidades
 - Scripts e migrations organizados agilizam evolu√ß√£o de schema e pol√≠ticas

---

## CONCLUS√ÉO: GEREZIM COMO CLUBE PRIVADO DE ELITE

### Status Atual

O GEREZIM possui uma **funda√ß√£o t√©cnica excelente** com:
- ‚úÖ Autentica√ß√£o e RLS robustos
- ‚úÖ Sistema de convites com aprova√ß√£o
- ‚úÖ Dashboard com 8 tipos de gr√°ficos
- ‚úÖ Concierge b√°sico operacional
- ‚úÖ Tarefas e timeline com auditoria
- ‚úÖ Stack moderno (Next.js, TypeScript, Tailwind, Supabase)
- ‚úÖ Deploy em Vercel com CI/CD

### O que Falta Para Ser um Clube Verdadeiro

Por√©m, o projeto ainda **n√£o possui a identidade estrat√©gica** de um clube exclusivo:

1. **Sem diferencia√ß√£o clara de tiers** ‚Üí N√£o h√° "Silver", "Gold", "Black" com perks reais
2. **Sem matching inteligente** ‚Üí Recomenda√ß√µes s√£o gen√©ricas, n√£o personalizadas
3. **Sem m√≥dulo de valuation** ‚Üí N√£o h√° an√°lise de viabilidade de deals
4. **Sem "Black Book"** ‚Üí N√£o h√° oportunidades 100% privadas/confidenciais
5. **Sem DNA de compra** ‚Üí N√£o h√° hist√≥rico de comportamento do membro
6. **Design system inconsistente** ‚Üí Componentes funcionam mas n√£o escal√°veis visualmente
7. **Sem IA** ‚Üí Tudo manual, sem automa√ß√£o inteligente

### Impacto da Implementa√ß√£o Sugerida

Aplicando as melhorias propostas neste documento:

**Curto Prazo (Q1 2025):**
- Plataforma com identidade visual coerente (design system)
- 3 dashboards diferenciados por n√≠vel (Silver/Gold/Black)
- Algoritmo b√°sico de matching (aumenta convers√£o em 30%)
- Documenta√ß√£o clara para onboarding (reduz tempo de ado√ß√£o)

**M√©dio Prazo (Q2 2025):**
- Tiers operacionais com billing (receita recorrente)
- Concierge com IA para pr√©-atendimento (reduz carga de work)
- Deals privados com RLS separada (diferencia Gold vs Black)
- Valuation express integrado (agrega valor para Black)
- Hist√≥rico de comportamento (recomenda√ß√µes +50% melhores)

**Longo Prazo (Q3-Q4 2025):**
- Matching autom√°tico em tempo real (notifica√ß√µes push)
- Deal origination para Black (intermediadores procuram para voc√™)
- Analytics avan√ßadas (visibilidade total de neg√≥cios)
- 1000+ membros ativos + 100+ intermediadores
- Maior club de deals privados do Brasil

### Recomenda√ß√£o Final

O GEREZIM **n√£o precisa ser reescrito** ‚Äî est√° bem arquitetado. Mas precisa:

1. **Incorporar estrat√©gia em cada layer** (n√£o apenas funcionalidades)
2. **Implementar diferencia√ß√£o clara de tiers** (faz sentido o membro pagar mais)
3. **Adicionar intelig√™ncia** (matching, valuation, scoring)
4. **Formalizar design e UX** (para escalar com qualidade)
5. **Automatizar o m√°ximo poss√≠vel** (reduzir trabalho manual)

Com isso, passa de ser um "sistema de gerenciamento de deals" para ser um **"Clube Privado Digital de Elite"** ‚Äî e a√≠ sim pode cobrar premium.

### Pr√≥ximos Passos

1. **Semana 1:** Apresentar este documento ao time
2. **Semana 2-3:** Design system (tokens + componentes)
3. **Semana 4:** Dashboards por tier
4. **Semana 5:** Matching inteligente basic
5. **Semana 6:** Testes, refinamento, deploy

**Estimativa:** 6-8 semanas para transformar em clube verdadeiro.

---

**Documento revisado em:** 8 de dezembro de 2025
**Status:** Pronto para implementa√ß√£o